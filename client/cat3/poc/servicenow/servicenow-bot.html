<!DOCTYPE html>
<html>
<head>
  <base >
</head>
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="../../src/partials/globals/toaster/angular-toastr.css" />
<script src="../../bower_components/angular/angular.js"></script>
<script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.5.0.min.js"></script>
<script src="../../src/partials/globals/toaster/angular-toastr.tpls.js"></script>

<script>


    
    var app = angular.module('poc', ['ui.bootstrap','toastr']);

    app.controller('ServiceNowBOTCtrl', function( $scope, $http,$location,$uibModal,toastr,$timeout,$window) {
        var crtl=this;
        crtl.newEnt={};
        crtl.auth=[];
        crtl.getBOTDetail = function (BotName, Token) {
            crtl.auth.BotName=BotName;
            crtl.auth.Token=Token;
          return $http({
            method: 'get', 
           // url:"http://d4d.rlcatalyst.com/botsNew?filterBy=id:rlcatalyst_org_creation",
            url:"../../../botsNew?filterBy=" + BotName,
            headers: {
             // 'x-catalyst-auth': '855a95b6-9670-4f40-96c0-2d6e089d07b7',
              'x-catalyst-auth': Token,
              'Accept': 'application/json'
              }
             }).then(function(response) {
              crtl.BOTData =  response.data;
              angular.forEach(response.data.bots[0].inputFormFields,function (val) {
                  crtl.newEnt[val.name]=val.default;
              });
          
          });
        };
        crtl.save = function () {
            return $http({
                method: 'POST',
                // url:"http://d4d.rlcatalyst.com/botsNew?filterBy=id:rlcatalyst_org_creation",
                url:'../../../botsNew/' + crtl.auth.BotName.split(":")[1] + '/execute',
                data:crtl.newEnt,
                headers: {
                    // 'x-catalyst-auth': '855a95b6-9670-4f40-96c0-2d6e089d07b7',
                    'x-catalyst-auth': crtl.auth.Token,
                    'Accept': 'application/json'
                }
            }).then(function(response) {
                toastr.success("Successfully executed");
                $timeout(function () {
                  $window.close();
                },400);
            });

        };

        crtl.init=function () {
            var paramQuery = location.search.substring(1);
            if(paramQuery) {
                var BotNameParam = paramQuery.split("&");
                // console.log(BotNameParam[0]);
                var botName = BotNameParam[0].split("=")[1];
                var token = BotNameParam[1].split("=")[1];
                crtl.getBOTDetail(botName, token);
            }
          // console.log("After init BOT data"+ $scope.BOTData);
           
        };

        crtl.init();
    }); 
   

</script>
<style>
  .repo-job-details-wrapper {
    border: 1px solid #dddddd;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
  }
  .repo-job-details-wrapper-inner {
    border: 0 none;
    padding: 0;
    width: auto;
    margin-bottom: 0;
    font-size: 15px;
    color: #666;
  }
  .margintop15{
    margin-top: 15px !important;
  }
</style>
<body ng-app="poc">
<div ng-controller="ServiceNowBOTCtrl as serCt"  browser="html5">
  <div class="">
    <div class="col-lg-3 col-md-3 col-sm-0"></div>
    <div class="col-lg-6 col-md-6 col-sm-12">
      <form>
      <fieldset class="repo-job-details-wrapper">
        <legend class="repo-job-details-wrapper-inner">BOTs Details:</legend>
        <div class="col-lg-6 col-md-6 margintop15" ng-repeat="field in serCt.BOTData.bots[0].inputFormFields" ng-switch="field.type">
          <label>{{field.label}}:
          </label>
          <input ng-switch-when="text" type="text" class="form-control" ng-model="serCt.newEnt[field.name]" />
          <input ng-switch-when="password" type="password" class="form-control" ng-model="serCt.newEnt[field.name]"  />
        </div>
        <div class="" style=" clear: both"></div>
        <div class="pull-right" style="margin: 10px 14px;">
          <button type="button" class="btn btn-primary" ng-click="serCt.save();"> <i class="fa fa-floppy-o white" aria-hidden="true"></i> Execute</button>
        </div>
      </fieldset>
      </form>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-0"></div>
  </div>
</div> 


</body>
</html>
